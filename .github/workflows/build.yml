name: Build SimpleTalk

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-linux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '21'
      - name: Build with Maven
        run: mvn -B package --file pom.xml
      - name: Package Linux app (.deb)
        run: |
          mkdir input
          cp target/*-SNAPSHOT.jar input/app.jar
          jpackage \
            --input input \
            --name SimpleTalk \
            --main-jar app.jar \
            --main-class com.example.websocket_project.client.App \
            --type deb \
            --app-version 1.0.0 \
            --vendor "Hemra Ashyrov Pvt." \
            --dest out
      - uses: actions/upload-artifact@v3
        with:
          name: linux-build
          path: out/*

  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '21'
      - name: Build with Maven
        run: mvn -B package --file pom.xml
      - name: Package Windows app (.exe)
        run: |
          mkdir input
          copy target\*-SNAPSHOT.jar input\app.jar
          jpackage ^
            --input input ^
            --name SimpleTalk ^
            --main-jar app.jar ^
            --main-class com.example.websocket_project.client.App ^
            --type exe ^
            --app-version 1.0.0 ^
            --vendor "Hemra Ashyrov Pvt." ^
            --icon icon.ico ^
            --dest out
      - uses: actions/upload-artifact@v3
        with:
          name: windows-build
          path: out/*

  build-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: '21'
      - name: Build with Maven
        run: mvn -B package --file pom.xml
      - name: Package MacOS app (.dmg)
        run: |
          mkdir input
          cp target/*-SNAPSHOT.jar input/app.jar
          jpackage \
            --input input \
            --name SimpleTalk \
            --main-jar app.jar \
            --main-class com.example.websocket_project.client.App \
            --type dmg \
            --app-version 1.0.0 \
            --vendor "Hemra Ashyrov Pvt." \
            --dest out
      - uses: actions/upload-artifact@v3
        with:
          name: macos-build
          path: out/*
